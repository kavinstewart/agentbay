#!/usr/bin/env bash
# Usage:
#   scripts/keyenv OPENAI /run/secrets/openai.key your_command --flags
#   scripts/keyenv ANTHROPIC /run/secrets/anthropic.key claude --flag
set -euo pipefail
[[ $# -ge 3 ]] || { echo "usage: keyenv {OPENAI|ANTHROPIC|GEMINI|OPENROUTER} /path/to/keyfile -- cmd ..."; exit 64; }
SERVICE="$1"; KEYFILE="$2"; shift 2
SECRET="$(<"$KEYFILE")"
case "$SERVICE" in
  OPENAI)      OPENAI_API_KEY="$SECRET" "$@" ;;
  ANTHROPIC)   ANTHROPIC_API_KEY="$SECRET" "$@" ;;
  GEMINI)      GEMINI_API_KEY="$SECRET" "$@" ;;
  OPENROUTER)  OPENROUTER_API_KEY="$SECRET" "$@" ;;
  *) echo "unknown service: $SERVICE"; exit 64 ;;
esac
